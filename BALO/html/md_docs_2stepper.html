<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BALO: I2C &amp; Stepper Modul [ARM Balancer]</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BALO
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md_docs_2stepper.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">I2C &amp; Stepper Modul [ARM Balancer] </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md11"></a></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md12"></a>
Table of Contents</h1>
<ul>
<li>Installation</li>
<li>Example</li>
<li>Authors</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="autotoc_md13"></a>
Installation</h1>
<ol type="1">
<li>create new project in the STM32CubeIDE</li>
<li>copy the content of <span class="tt">Examples/Test_Step_Motor.c</span> into the <span class="tt">main.c</span> of your project</li>
<li>copy the <span class="tt">system_stm32f4xx.c</span> from <span class="tt">CMSIS/Src/</span> to <span class="tt">YOURPROJECT/Src/</span></li>
<li>change the properties of your project<ol type="a">
<li>open the properties of your project then expand <span class="tt">C/C++ Build</span> → <span class="tt">Settings</span> → <span class="tt">MCU Settings</span> <img src="img/mcu-settings.png" alt="" class="inline"/>&#160;</li>
</ol>
<ol type="a">
<li>make sure <span class="tt">Floating-point unit</span> is set to <span class="tt">FPv4-SP-D16</span> <br  />
</li>
<li>set the <span class="tt">Floating-point ABI</span> to <span class="tt">mix HW/SW implementation (-mfloat-abi=softfp)</span></li>
<li>expand <span class="tt">C/C++ Build</span> → <span class="tt">Settings</span> → expand <span class="tt">MCU GCC Assembler</span> → <span class="tt">Include paths</span> and add the following paths: <div class="fragment"><div class="line">&quot;${workspace_loc:/Balancer}&quot;</div>
<div class="line">&quot;${workspace_loc:/MCAL}&quot;</div>
<div class="line">&quot;${workspace_loc:/CMSIS}&quot;</div>
</div><!-- fragment --></li>
</ol>
<ol type="a">
<li>expand <span class="tt">C/C++ Build</span> → <span class="tt">Settings</span> → expand <span class="tt">MCU GCC Compiler</span> → <span class="tt">Include paths</span> and add the following paths: <span class="tt">
      "${workspace_loc:/Balancer}"
      "${workspace_loc:/MCAL}"
      "${workspace_loc:/CMSIS}"
      "${workspace_loc:/MCAL/Inc}"
      "${workspace_loc:/MCAL/Inc/mcalTimer}"
      "${workspace_loc:/CMSIS/Include}"
      "${workspace_loc:/CMSIS/Device/ST/STM32F4xx/Include}"
      "${workspace_loc:/Balancer/Inc}"
      "${workspace_loc:/Balancer/Src}"
      </span></li>
<li>expand <span class="tt">C/C++ Build</span> → <span class="tt">Settings</span> → expand <span class="tt">MCU GCC Linker</span> → <span class="tt">Libraries</span> → <span class="tt">Libraries (-l)</span> and add the following text: <span class="tt">
      Balancer
      MCAL
      CMSIS
      </span></li>
<li>on the same page in the <span class="tt">Library search path (-L)</span> section add these paths: <span class="tt">
      "${workspace_loc:/Balancer/Inc}"
      "${workspace_loc:/Balancer/Src}"
      "${workspace_loc:/Balancer/Debug}"
      "${workspace_loc:/MCAL/Debug}"
      "${workspace_loc:/MCAL/Debug/Src}"
      "${workspace_loc:/MCAL/Debug/Src/mcalTimer}"
      "${workspace_loc:/CMSIS/Debug}"
      "${workspace_loc:/CMSIS/Device/ST/STM32F4xx/Source/Templates}"
      </span><ol type="i">
<li>expand <span class="tt">C/C++ General</span> → <span class="tt">Paths and Symbols</span> select the <span class="tt">Debug</span> configuration. Open the <span class="tt">References</span> tab and make sure the checkboxes of the following items are checked: <span class="tt">
       Balancer
       MCAL
       CMSIS
       </span></li>
</ol>
</li>
</ol>
</li>
<li>try to debug</li>
<li>if any errors occur<ol type="a">
<li>delete the <span class="tt">MCAL401</span> if it shows up in step 4</li>
<li>make sure to the libraries are include in the right order (shown above)</li>
</ol>
</li>
</ol>
<h1 class="doxsection"><a class="anchor" id="autotoc_md14"></a>
Examples</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdint.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdbool.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stepper.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;i2c.h&gt;</span></div>
<div class="line"> </div>
<div class="line">uint8_t *<a class="code hl_function" href="adc_b_a_t_8h.html#a9b1d469d4f5a631f6ffc401afa1d7b01">convDecByteToHex</a>(uint8_t <span class="keywordtype">byte</span>);</div>
<div class="line">uint8_t vmax;</div>
<div class="line">uint8_t addr = 0xC2;    <span class="comment">// Schreibadresse des Motors</span></div>
<div class="line">uint8_t geschw = 0x00;  <span class="comment">// 0x0 bis 0xF</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    </div>
<div class="line">    <span class="comment">//StepL.init(...                        iRun,   iHold,  vMin,   vMax,   stepMode, rotDir, acceleration, securePosition)</span></div>
<div class="line">    <a class="code hl_function" href="i2c_a_m_i_s_8h.html#a6999d848525972bba2d4880d691a24f0">StepperInit</a>(&amp;StepL, i2c, i2cAddr_motL,  14,     1,      2,      14,         3,          1,      6,           0);</div>
<div class="line">    </div>
<div class="line">    </div>
<div class="line"><span class="comment">// ab hier umstellen auf struct amis.c</span></div>
<div class="line">    <span class="comment">/* Hauptprogramm: Endlosschleife */</span></div>
<div class="line">    <span class="keywordflow">while</span>(1)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; 500; ++i )</div>
<div class="line">        {</div>
<div class="line">        <span class="keywordtype">int</span> ac_pos = getActualPosition(0xC2); <span class="comment">// Auslesen der aktuellen Motorposition</span></div>
<div class="line">        setPosition(addr,  ac_pos+32767);</div>
<div class="line"> </div>
<div class="line">        }</div>
<div class="line">        softStop(0xc2);         <span class="comment">// Stoppt den Aktuellen Befehl</span></div>
<div class="line"> </div>
<div class="line">        setVmax(addr, geschw); <span class="comment">// Stetzt die Geschwindigkeit des Steppers</span></div>
<div class="line">        geschw++;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span>(geschw == 0xf)</div>
<div class="line">        {</div>
<div class="line">            geschw = 0x00;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aadc_b_a_t_8h_html_a9b1d469d4f5a631f6ffc401afa1d7b01"><div class="ttname"><a href="adc_b_a_t_8h.html#a9b1d469d4f5a631f6ffc401afa1d7b01">convDecByteToHex</a></div><div class="ttdeci">uint8_t * convDecByteToHex(uint8_t byte)</div><div class="ttdef"><b>Definition</b> adcBAT.c:152</div></div>
<div class="ttc" id="ai2c_a_m_i_s_8h_html_a6999d848525972bba2d4880d691a24f0"><div class="ttname"><a href="i2c_a_m_i_s_8h.html#a6999d848525972bba2d4880d691a24f0">StepperInit</a></div><div class="ttdeci">void StepperInit(Stepper_t *stepper, I2C_TypeDef *i2cBus, uint8_t i2cAddress, uint8_t iRun, uint8_t iHold, uint8_t vMin, uint8_t vMax, uint8_t stepMode, uint8_t rotationDirection, uint8_t acceleration, uint16_t securePosition)</div><div class="ttdef"><b>Definition</b> i2cAMIS.c:783</div></div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="autotoc_md15"></a>
Authors</h1>
<ul>
<li><a href="#" onclick="location.href='mai'+'lto:'+'ste'+'fa'+'n.h'+'ei'+'nri'+'ch'+'@dh'+'bw'+'-en'+'gi'+'nee'+'ri'+'ng.'+'de'; return false;">Stefan Heinrich</a></li>
<li><a href="#" onclick="location.href='mai'+'lto:'+'den'+'ni'+'s.l'+'ot'+'z@d'+'hb'+'w-e'+'ng'+'ine'+'er'+'ing'+'.d'+'e'; return false;">Dennis Lotz</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for BALO by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
